<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vacaciones en el Sur ‚Äî Turismo en Valdivia</title>
  <meta name="description" content="Tours fluviales y terrestres en Valdivia y la Regi√≥n de los R√≠os. Reserva por formulario." />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@300;400;500;600&family=Satisfy&display=swap" rel="stylesheet">

  <style>
    :root{
      --sun1:#ff7a18;
      --sun2:#ff3d77;
      --sun3:#7c3aed;
      --sun4:#ffd36a;

      --ink:#16151a;
      --muted:#5a5564;

      --card:#ffffff;
      --border: rgba(22,21,26,.10);
      --shadow: 0 16px 50px rgba(22,21,26,.10);
      --shadow2: 0 10px 24px rgba(22,21,26,.10);

      --radius: 18px;

      /* Buttons (calm / not eye-killing) */
      --btn-ink:#1b1620;
      --btn-bg: rgba(255,255,255,.88);
      --btn-bd: rgba(22,21,26,.12);
      --btn-shadow: 0 14px 34px rgba(22,21,26,.12);

      --btn-accent: rgba(255,122,24,.18);
      --btn-accent2: rgba(255,61,119,.14);

      --headerH: 78px;
    }

    *{ box-sizing:border-box; }
    html{ scroll-behavior:smooth; }
    body{
      margin:0;
      font-family:Poppins, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background: linear-gradient(180deg, #fff7f1 0%, #fff2fb 35%, #f7fbff 100%);
      overflow-x:hidden;
    }

    /* Subtle animated sunset blobs */
    body::before,
    body::after{
      content:"";
      position:fixed;
      inset:-20%;
      z-index:-1;
      opacity:.55;
      filter: blur(40px);
      pointer-events:none;
      animation: floaty 14s ease-in-out infinite;
      background:
        radial-gradient(420px 320px at 18% 20%, rgba(255,122,24,.55), transparent 60%),
        radial-gradient(520px 360px at 78% 24%, rgba(255,61,119,.40), transparent 62%),
        radial-gradient(520px 420px at 52% 82%, rgba(124,58,237,.22), transparent 60%),
        radial-gradient(520px 360px at 30% 78%, rgba(255,211,106,.40), transparent 62%);
    }
    body::after{
      opacity:.35;
      animation-duration: 18s;
      animation-direction: reverse;
    }
    @keyframes floaty{
      0%{ transform: translate3d(0,0,0) scale(1); }
      50%{ transform: translate3d(3%, -2%, 0) scale(1.03); }
      100%{ transform: translate3d(0,0,0) scale(1); }
    }

    a{ color:inherit; text-decoration:none; }
    .container{ width:min(1160px, 92vw); margin:0 auto; }

    /* Header */
    header{
      position:fixed; top:0; left:0; right:0;
      z-index:50;
      background: rgba(255,255,255,.72);
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(22,21,26,.08);
    }
    .nav{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 0;
      gap:12px;
    }

    .brand{
      display:flex; align-items:center; gap:12px;
      min-width: 240px;
    }
    .logo{
      width:42px; height:42px;
      border-radius:999px;
      background: conic-gradient(from 220deg, var(--sun1), var(--sun2), var(--sun3), var(--sun4), var(--sun1));
      box-shadow: 0 12px 30px rgba(255,122,24,.20);
      display:grid; place-items:center;
      border:1px solid rgba(22,21,26,.10);
      flex: 0 0 auto;
    }
    .logo span{
      font-family:"Satisfy", cursive;
      font-size:18px;
      color:white;
      transform: translateY(-1px);
      user-select:none;
      text-shadow: 0 10px 20px rgba(0,0,0,.18);
    }
    .brand h1{
      margin:0;
      font-size:13px;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-weight:600;
      line-height:1.2;
    }
    .brand small{
      display:block;
      margin-top:2px;
      font-size:12px;
      color:var(--muted);
      line-height:1.2;
    }

    .nav-right{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
      min-width: 360px;
    }

    nav{
      max-width: 520px;
      overflow:auto hidden;
      scrollbar-width:none;
    }
    nav::-webkit-scrollbar{ display:none; }
    nav ul{
      display:flex; gap:10px;
      list-style:none; padding:0; margin:0;
      align-items:center;
      flex-wrap:nowrap;
      white-space:nowrap;
    }
    nav a{
      font-size:13px;
      color:#2b2832;
      padding:8px 10px;
      border-radius:999px;
      transition: background .15s ease, transform .15s ease;
      border:1px solid transparent;
    }
    nav a:hover{
      background: rgba(255,122,24,.10);
      transform: translateY(-1px);
    }

    .mode-btn{
      border:1px solid rgba(22,21,26,.10);
      background: rgba(255,255,255,.75);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:#2b2832;
      cursor:pointer;
      display:flex;
      gap:8px;
      align-items:center;
      user-select:none;
      white-space:nowrap;
    }
    .mode-dot{
      width:10px; height:10px; border-radius:999px;
      background: rgba(90,85,100,.45);
      box-shadow: 0 0 0 4px rgba(90,85,100,.10);
    }
    .mode-btn[data-on="true"] .mode-dot{
      background: linear-gradient(135deg, var(--sun4), var(--sun1), var(--sun2));
      box-shadow: 0 0 0 6px rgba(255,122,24,.14);
    }

    /* Scroller (page) */
    #scroller{
      height: 100vh;
      overflow-y:auto;
      overflow-x:hidden;
      padding-top: var(--headerH);
      scroll-behavior:smooth;
    }

    /* Step sections */
    [data-step]{
      min-height: calc(100vh - var(--headerH));
      padding: 44px 0;
      display:flex;
      flex-direction:column;
      justify-content:flex-start;
    }

    /* Hero */
    .hero-box{
      border-radius: 26px;
      background: rgba(255,255,255,.70);
      border:1px solid rgba(22,21,26,.08);
      box-shadow: var(--shadow);
      padding:26px;
      overflow:hidden;
      position:relative;
    }
    .hero-box::before{
      content:"";
      position:absolute;
      inset:-2px;
      z-index:0;
      opacity:.45;
      background:
        radial-gradient(520px 320px at 10% 10%, rgba(255,122,24,.50), transparent 60%),
        radial-gradient(560px 360px at 90% 20%, rgba(255,61,119,.35), transparent 62%),
        radial-gradient(520px 420px at 55% 120%, rgba(124,58,237,.18), transparent 62%);
      filter: blur(40px);
      pointer-events:none;
    }
    .hero-content{ position:relative; z-index:1; }

    .kicker{
      display:inline-flex; align-items:center; gap:10px;
      font-size:12px;
      letter-spacing:.22em;
      text-transform:uppercase;
      color:#3c3646;
      margin-bottom:10px;
    }
    .dot{
      width:10px; height:10px;
      border-radius:999px;
      background: linear-gradient(135deg, var(--sun4), var(--sun1), var(--sun2));
      box-shadow: 0 0 0 6px rgba(255,122,24,.12);
    }

    .hero-title{
      margin:0;
      font-family:"Playfair Display", serif;
      font-size:44px;
      line-height:1.05;
      letter-spacing:.01em;
    }
    .hero-title .script{
      font-family:"Satisfy", cursive;
      font-weight:400;
      background: linear-gradient(90deg, var(--sun1), var(--sun2), var(--sun4));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }
    .hero-sub{
      margin:12px 0 0;
      max-width:75ch;
      color:#3c3646;
      font-size:15px;
    }
    .hero-sub b{ color:#221f29; }

    .hero-row{
      margin-top:16px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:#2b2832;
      background: rgba(255,255,255,.75);
      border:1px solid rgba(22,21,26,.08);
    }

    /* Groups block under hero */
    .group-hero{
      margin-top:14px;
      border-radius: 22px;
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(22,21,26,.08);
      box-shadow: var(--shadow2);
      padding:16px;
      display:flex;
      align-items:flex-start;
      gap:14px;
      flex-wrap:wrap;
    }
    .group-hero .icon{
      width:46px; height:46px; border-radius:16px;
      background: linear-gradient(135deg, rgba(255,211,106,.38), rgba(255,122,24,.20), rgba(255,61,119,.14));
      border:1px solid rgba(22,21,26,.08);
      display:grid; place-items:center;
      font-size:20px;
      user-select:none;
      flex:0 0 auto;
    }
    .group-hero h3{
      margin:0;
      font-size:13px;
      letter-spacing:.14em;
      text-transform:uppercase;
      color:#2b2832;
      font-weight:700;
    }
    .group-hero p{
      margin:8px 0 0;
      color:#3c3646;
      font-size:13px;
      line-height:1.6;
      max-width:78ch;
    }
    .group-hero .cta{
      margin-left:auto;
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }

    /* Buttons */
    .btn{
      border:0;
      border-radius: 14px;
      padding:11px 14px;
      font-weight:600;
      font-size:13px;
      cursor:pointer;
      display:inline-flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      transition: transform .12s ease, filter .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
      white-space:nowrap;
      flex: 0 0 auto; /* IMPORTANT: prevent tall stretching */
    }
    .btn:active{ transform: translateY(1px); }

    .btn-primary{
      color:var(--btn-ink);
      background: var(--btn-bg);
      border:1px solid var(--btn-bd);
      box-shadow: var(--btn-shadow);
    }
    .btn-primary:hover{
      border-color: rgba(255,122,24,.26);
      background: linear-gradient(135deg, rgba(255,255,255,.92), rgba(255,122,24,.06), rgba(255,61,119,.05));
    }

    .btn-ghost{
      color:#2b2832;
      background: rgba(255,255,255,.75);
      border:1px solid rgba(22,21,26,.10);
    }
    .btn-ghost:hover{ background: rgba(255,122,24,.10); }

    /* Section heads */
    .section-head{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:16px;
      margin-bottom:14px;
    }
    .section-head h2{
      margin:0;
      font-size:18px;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-weight:600;
      color:#2b2832;
    }
    .section-head p{
      margin:0;
      color:var(--muted);
      font-size:13px;
    }

    /* Cards grid (desktop) */
    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:14px;
    }

    .card{
      background: rgba(255,255,255,.85);
      border:1px solid rgba(22,21,26,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      padding:16px;
      display:flex;
      flex-direction:column;
      min-height:unset; /* avoid forced height */
    }
    .tag{
      width:max-content;
      font-size:11px;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-weight:700;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(255,122,24,.12);
      color:#2b2832;
      border:1px solid rgba(255,122,24,.18);
      margin-bottom:10px;
    }
    .card h3{
      margin:0;
      font-size:17px;
      font-weight:600;
      color:#221f29;
      line-height:1.25;
    }
    .meta{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .meta .mini{
      font-size:12px;
      color:#2b2832;
      background: rgba(255,255,255,.90);
      border:1px solid rgba(22,21,26,.08);
      padding:6px 10px;
      border-radius:999px;
    }
    .desc{
      margin:10px 0 0;
      color:#3c3646;
      font-size:13px;
    }
    .price{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      color:#221f29;
      font-size:13px;
      font-weight:500;
    }

    /* ‚úÖ ACTIONS: grid 2 cols, no flex-grow => NO GIANT BUTTONS */
    .actions{
      margin-top:12px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .actions .btn{
      width:100%;
      padding:10px 12px;
      border-radius: 14px;
      flex: 0 0 auto; /* key fix */
    }

    /* Alojamiento */
    .stay{
      background: rgba(255,255,255,.80);
      border:1px solid rgba(22,21,26,.08);
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding:18px;
    }
    .stay h3{
      margin:0;
      font-family:"Playfair Display", serif;
      font-size:28px;
      color:#221f29;
    }
    .stay p{
      margin:8px 0 0;
      color:#3c3646;
      font-size:14px;
      max-width:75ch;
    }
    .stay-list{
      margin-top:14px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
    }
    .stay-item{
      border-radius: 18px;
      border:1px solid rgba(22,21,26,.08);
      background: rgba(255,255,255,.90);
      padding:14px;
    }
    .stay-item b{ display:block; font-size:13px; color:#221f29; }
    .stay-item span{ display:block; margin-top:4px; font-size:12.5px; color:#3c3646; }
    .stay-actions{
      margin-top:14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .note{
      font-size:12px;
      color:var(--muted);
    }

    /* About */
    .about-grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:14px;
    }
    .box{
      background: rgba(255,255,255,.80);
      border:1px solid rgba(22,21,26,.08);
      border-radius: 22px;
      box-shadow: var(--shadow2);
      padding:18px;
    }
    .box h3{
      margin:0;
      font-size:13px;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-weight:700;
      color:#2b2832;
    }
    .box p{
      margin:10px 0 0;
      color:#3c3646;
      font-size:14px;
      line-height:1.6;
    }
    .values{
      margin-top:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .value{
      border:1px solid rgba(22,21,26,.08);
      background: rgba(255,255,255,.90);
      border-radius: 16px;
      padding:12px;
    }
    .value b{ display:block; font-size:13px; color:#221f29; }
    .value span{ display:block; margin-top:2px; font-size:12.5px; color:#3c3646; }

    footer{
      padding:26px 0 52px;
      text-align:center;
      color:var(--muted);
      font-size:12px;
      border-top:1px solid rgba(22,21,26,.06);
    }

    /* Modal */
    .backdrop{
      position:fixed; inset:0;
      background: rgba(22,21,26,.22);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:80;
      backdrop-filter: blur(6px);
    }
    .modal{
      width:min(640px, 96vw);
      background: rgba(255,255,255,.92);
      border:1px solid rgba(22,21,26,.10);
      border-radius: 24px;
      box-shadow: 0 24px 70px rgba(22,21,26,.18);
      overflow:hidden;
      max-height: 86vh;
      overflow-y:auto;
    }
    .modal-head{
      padding:14px 16px;
      border-bottom:1px solid rgba(22,21,26,.08);
      display:flex;
      justify-content:space-between;
      gap:10px;
      background: linear-gradient(135deg, rgba(255,211,106,.35), rgba(255,122,24,.18), rgba(255,61,119,.12));
      position: sticky;
      top: 0;
      z-index: 2;
    }
    .modal-head h4{
      margin:0;
      font-size:13px;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-weight:700;
      color:#2b2832;
    }
    .modal-head p{
      margin:6px 0 0;
      color:#3c3646;
      font-size:12.5px;
    }
    .x{
      width:40px; height:40px;
      border-radius:14px;
      border:1px solid rgba(22,21,26,.10);
      background: rgba(255,255,255,.75);
      cursor:pointer;
      font-size:18px;
      line-height:1;
      flex:0 0 auto;
    }
    .modal-body{ padding:16px; }
    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin:10px 0 6px;
    }
    input, textarea, select{
      width:100%;
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(22,21,26,.10);
      outline:none;
      font-size:14px;
      background:#fff;
      color:#221f29;
    }
    textarea{ min-height:92px; resize:vertical; }
    input:focus, textarea:focus, select:focus{
      border-color: rgba(255,122,24,.45);
      box-shadow: 0 0 0 4px rgba(255,122,24,.14);
    }
    .meta-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:10px;
    }
    .chip{
      font-size:12px;
      border:1px solid rgba(22,21,26,.08);
      background: rgba(255,255,255,.85);
      border-radius:999px;
      padding:6px 10px;
      color:#2b2832;
    }
    .modal-actions{
      margin-top:14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .info{
      margin-top:10px;
      padding:12px;
      border-radius: 16px;
      background: rgba(255,255,255,.85);
      border:1px solid rgba(22,21,26,.08);
      color:#3c3646;
      font-size:13px;
      line-height:1.6;
      white-space:pre-line;
    }

    /* Toast */
    .toast{
      position:fixed;
      left:50%;
      bottom:22px;
      transform:translateX(-50%);
      background: rgba(255,255,255,.92);
      border:1px solid rgba(22,21,26,.10);
      border-radius:999px;
      padding:12px 14px;
      box-shadow: 0 18px 40px rgba(22,21,26,.14);
      display:none;
      z-index:90;
      color:#221f29;
      font-size:13px;
      max-width:92vw;
      text-align:center;
    }

    /* Step dots */
    .dots{
      position:fixed;
      right:14px;
      top: calc(var(--headerH) + 12px);
      z-index:60;
      display:none;
      gap:8px;
      flex-direction:column;
      padding:10px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.65);
      border:1px solid rgba(22,21,26,.08);
      backdrop-filter: blur(8px);
    }
    .dots button{
      width:10px; height:10px;
      border-radius:999px;
      border:0;
      cursor:pointer;
      background: rgba(90,85,100,.35);
      box-shadow: 0 0 0 5px rgba(90,85,100,.08);
    }
    .dots button.active{
      background: linear-gradient(135deg, var(--sun4), var(--sun1), var(--sun2));
      box-shadow: 0 0 0 7px rgba(255,122,24,.14);
    }
    html.step-mode .dots{ display:flex; }

    /* Responsive */
    @media (max-width: 980px){
      .grid{ grid-template-columns: repeat(2, 1fr); }
      .hero-title{ font-size:36px; }
      .group-hero .cta{ margin-left:0; width:100%; }
      .nav-right{ min-width:auto; }
    }

    @media (max-width: 760px){
      .brand{ min-width:auto; }
      .nav-right{ gap:8px; }
      .mode-btn{ padding:7px 9px; }
      .hero-title{ font-size:32px; }

      /* ‚úÖ Mobile: tours as horizontal carousel (no endless vertical scroll) */
      .grid{
        display:flex;
        gap:12px;
        overflow-x:auto;
        overflow-y:hidden;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 6px;
      }
      .grid::-webkit-scrollbar{ display:none; }
      .card{
        flex: 0 0 86%;
        scroll-snap-align: start;
      }

      .actions{
        grid-template-columns: 1fr 1fr; /* keep 2 buttons, not stacked huge */
      }
      .actions .btn{
        padding:10px 10px;
        font-size:13px;
      }

      .stay-list{ grid-template-columns:1fr; }
      .about-grid{ grid-template-columns:1fr; }
      .dots{ right:10px; }
    }

    @media (max-width: 380px){
      .actions{ grid-template-columns: 1fr; } /* ultra small: 1 col but normal height */
    }
  </style>
</head>

<body>
  <header id="header">
    <div class="container">
      <div class="nav">
        <a class="brand" href="#inicio" aria-label="Vacaciones en el Sur" onclick="navTo('inicio'); return false;">
          <div class="logo"><span>V</span></div>
          <div>
            <h1>Vacaciones en el Sur</h1>
            <small>Valdivia ‚Ä¢ Regi√≥n de los R√≠os</small>
          </div>
        </a>

        <div class="nav-right">
          <nav aria-label="Navegaci√≥n">
            <ul>
              <li><a href="#tours-fluviales" onclick="navTo('tours-fluviales'); return false;">Tours fluviales</a></li>
              <li><a href="#tours-terrestres" onclick="navTo('tours-terrestres'); return false;">Tours terrestres</a></li>
              <li><a href="#alojamiento" onclick="navTo('alojamiento'); return false;">Alojamiento</a></li>
              <li><a href="#quienes-somos" onclick="navTo('quienes-somos'); return false;">Qui√©nes somos</a></li>
            </ul>
          </nav>

          <!-- ‚úÖ Step mode toggle -->
          <button class="mode-btn" id="modeBtn" type="button" data-on="true" title="Activa/desactiva navegaci√≥n paso a paso">
            <span class="mode-dot"></span>
            <span id="modeText">Paso a paso: ON</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Dots -->
  <div class="dots" id="dots" aria-label="Navegaci√≥n por secciones"></div>

  <div id="scroller">
    <main class="container">

      <!-- HERO -->
      <section id="inicio" data-step>
        <div class="hero-box">
          <div class="hero-content">
            <div class="kicker"><span class="dot"></span> Turismo ‚Ä¢ Experiencias reales</div>

            <h2 class="hero-title">
              Vacaciones en el Sur<br>
              de <span class="script">Chile</span>
            </h2>

            <p class="hero-sub">
              R√≠os, humedales, castillos, selva valdiviana y rutas full day.
              T√∫ env√≠as la solicitud aqu√≠ y <b>nosotros te escribimos por WhatsApp</b> para coordinar horarios y pagos.
            </p>

            <div class="hero-row">
              <span class="pill">‚úÖ Sin redirecci√≥n</span>
              <span class="pill">‚ö° Respuesta r√°pida</span>
              <span class="pill">üßæ Solicitud al sistema</span>

              <button class="btn btn-ghost" onclick="navTo('tours-fluviales')">Ver tours</button>
              <button class="btn btn-ghost" onclick="navTo('alojamiento')">Ver alojamiento</button>
            </div>

            <div class="group-hero" id="grupos">
              <div class="icon">üë•</div>
              <div>
                <h3>Si vienes con un grupo, colegio o empresa</h3>
                <p>
                  Sabemos que un evento importante necesita organizaci√≥n, tiempo y alguien en quien confiar.
                  En Vacaciones del Sur te ayudamos a planificar todo con calma, para que t√∫ te despreocupes y tu grupo solo se dedique a disfrutar.
                  Agenda una reuni√≥n y armamos juntos una experiencia a tu ritmo y a la medida.
                </p>
              </div>
              <div class="cta">
                <button class="btn btn-primary" onclick="openMeeting()">Agendar reuni√≥n</button>
              </div>
            </div>

          </div>
        </div>
      </section>

      <!-- FLUVIALES -->
      <section id="tours-fluviales" data-step>
        <div class="section-head">
          <div>
            <h2>Tours fluviales</h2>
            <p>Valdivia por agua: castillos, santuarios, humedales, postales.</p>
          </div>
          <div class="note" style="text-align:right;">
            <span id="hintFluvial" style="display:none;">üëâ Desliza para ver m√°s</span>
          </div>
        </div>
        <div class="grid" id="grid-fluviales"></div>
      </section>

      <!-- TERRESTRES -->
      <section id="tours-terrestres" data-step>
        <div class="section-head">
          <div>
            <h2>Tours terrestres</h2>
            <p>Full day, termas, parques y rutas: naturaleza + cultura.</p>
          </div>
          <div class="note" style="text-align:right;">
            <span id="hintTerr" style="display:none;">üëâ Desliza para ver m√°s</span>
          </div>
        </div>
        <div class="grid" id="grid-terrestres"></div>
      </section>

      <!-- ALOJAMIENTO -->
      <section id="alojamiento" data-step>
        <div class="section-head">
          <div>
            <h2>Alojamiento</h2>
            <p>Opciones reales seg√∫n zona, fechas y capacidad.</p>
          </div>
        </div>

        <div class="stay">
          <h3>Tenemos estas opciones de alojamiento</h3>
          <p>
            Sin cat√°logo infinito. T√∫ mandas tu solicitud y te respondemos con alternativas que calzan contigo.
          </p>

          <div class="stay-list">
            <div class="stay-item">
              <b>Caba√±as con tinaja, quincho y vista incre√≠ble</b>
              <span>Ideal para desconectarse. Pareja o familia.</span>
            </div>
            <div class="stay-item">
              <b>Casas de turismo, hoteles en la costa</b>
              <span>Niebla / costa y alrededores.</span>
            </div>
            <div class="stay-item">
              <b>Opciones low cost</b>
              <span>Limpio, seguro, bien ubicado.</span>
            </div>
          </div>

          <div class="stay-actions">
            <button class="btn btn-primary" onclick="openReserve({ tipo:'Alojamiento', nombre:'Solicitud de alojamiento', id:'stay-1' })">
              Solicitar alojamiento
            </button>
            <span class="note">‚úÖ Se env√≠a al sistema. Luego te contactamos por WhatsApp.</span>
          </div>
        </div>
      </section>

      <!-- QUI√âNES SOMOS -->
      <section id="quienes-somos" data-step>
        <div class="section-head">
          <div>
            <h2>Qui√©nes somos</h2>
            <p>Turismo con prop√≥sito: aut√©ntico, accesible y memorable.</p>
          </div>
        </div>

        <div class="about-grid">
          <div class="box">
            <h3>Misi√≥n</h3>
            <p>
              Somos un puente de soluciones entre los viajeros y los encantos del sur, conect√°ndolos con experiencias aut√©nticas, accesibles y memorables.
              Creemos en un turismo con prop√≥sito, dando valor a la cultura local, sus emprendimientos y respetando el entorno natural.
            </p>

            <div style="height:10px"></div>

            <h3>Visi√≥n</h3>
            <p>
              Ser l√≠deres en innovaci√≥n tur√≠stica en la Regi√≥n de los R√≠os, transformando la forma en que las personas exploran nuestra regi√≥n mediante
              experiencias fluviales y terrestres √∫nicas, sostenibles y con alto impacto social.
            </p>

            <div style="height:10px"></div>

            <h3>Prop√≥sito</h3>
            <p>
              Crecer entregando valor en lo que hacemos, a nuestros colaboradores y entorno.
            </p>
          </div>

          <div class="box">
            <h3>Valores</h3>
            <div class="values">
              <div class="value">
                <b>Colaboraci√≥n</b>
                <span>Trabajo en equipo con emprendimientos y partners locales.</span>
              </div>
              <div class="value">
                <b>Compromiso</b>
                <span>Atenci√≥n real y cumplimiento.</span>
              </div>
              <div class="value">
                <b>Integridad</b>
                <span>Transparencia y respeto.</span>
              </div>
              <div class="value">
                <b>Innovaci√≥n</b>
                <span>Mejoramos la experiencia con soluciones simples.</span>
              </div>
            </div>

            <div class="modal-actions" style="margin-top:14px;">
              <button class="btn btn-primary" onclick="openMeeting()">Agendar reuni√≥n</button>
              <button class="btn btn-ghost" onclick="openReserve({ tipo:'Consulta', nombre:'Consulta general', id:'general-1' })">Enviar consulta</button>
            </div>
          </div>
        </div>

        <footer>
          ¬© <span id="year"></span> Vacaciones en el Sur ‚Äî Regi√≥n de los R√≠os
        </footer>
      </section>

    </main>
  </div>

  <!-- MODAL: RESERVA -->
  <div class="backdrop" id="reserveBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-head">
        <div>
          <h4 id="reserveTitle">Enviar solicitud</h4>
          <p>Deja tus datos. Te escribimos por WhatsApp para coordinar horarios y pagos.</p>
        </div>
        <button class="x" onclick="closeReserve()" aria-label="Cerrar">√ó</button>
      </div>

      <div class="modal-body">
        <div class="meta-row" id="reserveMeta"></div>

        <label for="r_nombre">Nombre</label>
        <input id="r_nombre" placeholder="Tu nombre" autocomplete="name" />

        <label for="r_tel">Tel√©fono (WhatsApp)</label>
        <input id="r_tel" placeholder="+56 9 1234 5678" autocomplete="tel" />

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
          <div>
            <label for="r_personas">N¬∞ personas (opcional)</label>
            <input id="r_personas" placeholder="Ej: 2" inputmode="numeric" />
          </div>
          <div>
            <label for="r_fecha">Fecha tentativa (opcional)</label>
            <input id="r_fecha" type="date" />
          </div>
        </div>

        <label for="r_msg">Mensaje (opcional)</label>
        <textarea id="r_msg" placeholder="Ej: disponibilidad / dudas / vamos con ni√±os"></textarea>

        <div class="modal-actions">
          <button class="btn btn-primary" onclick="submitReserve()">Enviar solicitud</button>
          <button class="btn btn-ghost" onclick="closeReserve()">Cancelar</button>
        </div>

        <div class="note" id="reserveNote" style="margin-top:10px;"></div>
      </div>
    </div>
  </div>

  <!-- MODAL: M√ÅS INFO -->
  <div class="backdrop" id="infoBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-head">
        <div>
          <h4 id="infoTitle">Detalle</h4>
          <p id="infoSubtitle">Informaci√≥n completa</p>
        </div>
        <button class="x" onclick="closeInfo()" aria-label="Cerrar">√ó</button>
      </div>
      <div class="modal-body">
        <div class="meta-row" id="infoMeta"></div>
        <div class="info" id="infoBody"></div>
        <div class="modal-actions">
          <button class="btn btn-primary" onclick="infoReserve()">Reservar este tour</button>
          <button class="btn btn-ghost" onclick="closeInfo()">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: REUNI√ìN -->
  <div class="backdrop" id="meetBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-head">
        <div>
          <h4>Agendar reuni√≥n</h4>
          <p>Lunes a s√°bado ‚Äî 08:00/09:00/10:00 y 18:00/19:00 (Chile).</p>
        </div>
        <button class="x" onclick="closeMeeting()" aria-label="Cerrar">√ó</button>
      </div>
      <div class="modal-body">
        <div class="meta-row">
          <span class="chip">üìå Grupo / Colegio / Empresa</span>
          <span class="chip">üïí Horarios predefinidos</span>
        </div>

        <label for="m_nombre">Nombre</label>
        <input id="m_nombre" placeholder="Tu nombre" autocomplete="name" />

        <label for="m_tel">Tel√©fono (WhatsApp)</label>
        <input id="m_tel" placeholder="+56 9 1234 5678" autocomplete="tel" />

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
          <div>
            <label for="m_dia">D√≠a</label>
            <select id="m_dia">
              <option value="">Selecciona‚Ä¶</option>
              <option>Lunes</option><option>Martes</option><option>Mi√©rcoles</option>
              <option>Jueves</option><option>Viernes</option><option>S√°bado</option>
            </select>
          </div>
          <div>
            <label for="m_hora">Hora</label>
            <select id="m_hora">
              <option value="">Selecciona‚Ä¶</option>
              <option>08:00</option><option>09:00</option><option>10:00</option>
              <option>18:00</option><option>19:00</option>
            </select>
          </div>
        </div>

        <label for="m_tema">Tema (opcional)</label>
        <textarea id="m_tema" placeholder="Ej: paseo de colegio / navegaci√≥n privada / empresa"></textarea>

        <div class="modal-actions">
          <button class="btn btn-primary" onclick="submitMeeting()">Enviar agenda</button>
          <button class="btn btn-ghost" onclick="closeMeeting()">Cancelar</button>
        </div>

        <div class="note" id="meetNote" style="margin-top:10px;"></div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    /***** ‚úÖ CONFIG: pega tu webhook aqu√≠ *****/
    const WEBHOOK_URL = "https://n8n-n8n.bvil2a.easypanel.host/webhook/2e98cf7f-b5fb-490c-8dac-05274a1d59e8";

    /***** DATA *****/
    const TOURS_FLUVIALES = [
      {
        id: "fluv-1",
        nombre: "Corral-Mancera",
        nivel: "Servicio guiado",
        descripcion: "Navegaci√≥n hacia los castillos espa√±oles de Corral y Mancera.",
        detallado:
`Navegaci√≥n en barco Neptuno por los r√≠os de Valdivia hasta la desembocadura en bah√≠a de Corral, visitando los castillos espa√±oles de Corral y Mancera.
Incluye almuerzo y once a bordo y relato hist√≥rico con servicio guiado.`,
        duracion_horas: 5,
        origen: "Valdivia",
        destino: "Castillos de Corral y Mancera",
        incluye_comidas: "Almuerzo y once a bordo",
        precio_adulto: 35000,
        precio_nino: 28000
      },
      {
        id: "fluv-2",
        nombre: "Punucapa",
        nivel: "Servicio guiado",
        descripcion: "Santuario Carlos Anwandter + Punucapa + degustaciones.",
        detallado:
`El tour a Punucapa ofrece navegaci√≥n hacia el Santuario Natural Carlos Anwandter, visita de la pintoresca localidad de Punucapa, degustaciones, suave caminata, feria costumbrista, visita a la iglesia de la virgen de la candelaria. Sale desde Valdivia. Servicio guiado.`,
        duracion_horas: 3.5,
        origen: "Valdivia",
        destino: "Punucapa, Santuario Carlos Anwandter",
        incluye_comidas: "Degustaciones",
        precio_adulto: 12000,
        precio_nino: 9600
      },
      {
        id: "fluv-3",
        nombre: "Isla Teja - City tour",
        nivel: "Servicio guiado",
        descripcion: "Puentes y r√≠os de Valdivia, rodeando Isla Teja.",
        detallado:
`Recorrido por los principales r√≠os y puentes de Valdivia, rodeando la Isla Teja y navegando por aguas del Santuario de la Naturaleza Carlos Anwandter.
Servicio guiado a bordo del barco Calle Calle con √©nfasis en la historia de la ciudad.`,
        duracion_horas: 1,
        origen: "Valdivia",
        destino: "Isla Teja y r√≠os de Valdivia",
        incluye_comidas: "",
        precio_adulto: 5000,
        precio_nino: 4000
      },
      {
        id: "fluv-4",
        nombre: "Santuario-Humedales",
        nivel: "Servicio guiado",
        descripcion: "Humedales del Santuario Carlos Anwandter, flora y fauna.",
        detallado:
`Navegaci√≥n por humedales de Valdivia dentro del Santuario de la Naturaleza Carlos Anwandter, disfrutando de paisajes y observaci√≥n de flora y fauna con servicio guiado.`,
        duracion_horas: 1.5,
        origen: "Valdivia",
        destino: "Humedales y Santuario Carlos Anwandter",
        incluye_comidas: "",
        precio_adulto: 5000,
        precio_nino: 4000
      }
    ];

    const TOURS_TERRESTRES = [
      {
        id: "terr-1",
        nombre: "Reserva Huilo Huilo",
        tipo: "Full day naturaleza",
        descripcion: "Hotel Monta√±a M√°gica, cascadas, museo y caverna volc√°nica.",
        detallado:
`Explora la Reserva Biol√≥gica Huilo Huilo visitando el Hotel Monta√±a M√°gica, varias cascadas, el Museo de los Volcanes y una caverna volc√°nica.
Combina senderos suaves con tiempo para fotos y descanso en medio de la selva patag√≥nica.`,
        duracion_horas: 13,
        opera_dias: "lunes a domingo",
        max_personas: 15,
        precio_adulto: 60000,
        precio_nino: 55000
      },
      {
        id: "terr-2",
        nombre: "Termas Huilo-Huilo",
        tipo: "Full day termas",
        descripcion: "Aguas c√°lidas + barro terap√©utico + r√≠o Ra√±intulelfu.",
        detallado:
`Sum√©rgete en piscinas termales de aguas c√°lidas, barro terap√©utico y el sonido del r√≠o Ra√±intulelfu.
Es un lugar poco masivo, ideal para relajarse sin multitudes ni filas.`,
        duracion_horas: 13,
        opera_dias: "lunes a domingo",
        max_personas: 15,
        precio_adulto: 67000,
        precio_nino: 62000
      },
      {
        id: "terr-3",
        nombre: "City Tour Valdivia-Niebla",
        tipo: "City tour cultural",
        descripcion: "Centro + Jard√≠n Bot√°nico + Castillo de Niebla.",
        detallado:
`Recorre los principales puntos de Valdivia, visita el Jard√≠n Bot√°nico y termina en el Castillo de Niebla.
Mezcla cultura, patrimonio e historia con naturaleza y breves caminatas.`,
        duracion_horas: 6,
        opera_dias: "lunes a domingo",
        max_personas: 15,
        precio_adulto: 20000,
        precio_nino: 15000
      },
      {
        id: "terr-4",
        nombre: "Parque Futangue",
        tipo: "Full day trekking",
        descripcion: "Laguna Pichi + saltos + Futrono. Intensidad media.",
        detallado:
`Explora el Parque Futangue con un trekking hacia la Laguna Pichi, visita los Saltos de Ri√±inahue y Nilahue y termina en Futrono.
Aventura con caminatas de intensidad media y paisajes de monta√±a y bosque.`,
        duracion_horas: 13,
        opera_dias: "lunes a domingo",
        max_personas: 15,
        precio_adulto: 64000,
        precio_nino: 59000
      },
      {
        id: "terr-5",
        nombre: "Parque Alerce Costero",
        tipo: "Full day naturaleza",
        descripcion: "Bosque valdiviano + caminata al Alerce Milenario.",
        detallado:
`Ad√©ntrate en el bosque valdiviano del Parque Alerce Costero y camina por senderos que llevan al Alerce Milenario.
Conexi√≥n total con naturaleza en un paisaje de paz y majestuosidad.`,
        duracion_horas: 13,
        opera_dias: "lunes a domingo",
        max_personas: 15,
        precio_adulto: 64000,
        precio_nino: 59000
      },
      {
        id: "terr-6",
        nombre: "Parque Oncol",
        tipo: "Full day cultura y naturaleza",
        descripcion: "City tour + almuerzo t√≠pico + mirador cerro Oncol.",
        detallado:
`Mezcla un city tour por Valdivia con una visita al Parque Oncol.
Tras un almuerzo t√≠pico se explora la selva valdiviana y se asciende al mirador del cerro Oncol.`,
        duracion_horas: 13,
        opera_dias: "lunes a domingo",
        max_personas: 15,
        precio_adulto: 50000,
        precio_nino: 45000
      },
      {
        id: "terr-7",
        nombre: "Termas Geom√©tricas",
        tipo: "Full day termas",
        descripcion: "Piscinas termales y pasarelas rojas en PN Villarrica.",
        detallado:
`Complejo termal dentro del Parque Nacional Villarrica.
Pasarelas de madera roja conectan piscinas de 35¬∞ a 42¬∞: relajaci√≥n en plena naturaleza.`,
        duracion_horas: 13,
        opera_dias: "lunes a domingo",
        max_personas: 15,
        precio_adulto: 80000,
        precio_nino: 75000
      }
    ];

    /***** Utils *****/
    const scroller = document.getElementById("scroller");
    const header = document.getElementById("header");

    const fmtCLP = (n) => {
      if (n === null || n === undefined || n === "") return "";
      try { return "$" + Number(n).toLocaleString("es-CL"); } catch { return "$" + n; }
    };

    function showToast(text){
      const t = document.getElementById("toast");
      t.textContent = text;
      t.style.display = "block";
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=> t.style.display="none", 3400);
    }

    function normalizePhone(raw){
      const s = String(raw || "").trim();
      if(!s) return "";
      let digits = s.replace(/[^\d+]/g, "");
      digits = digits.replace(/\+/g,"");
      if(digits.startsWith("0")) digits = digits.slice(1);
      if(digits.startsWith("56")) return "+" + digits;
      if(digits.startsWith("9")) return "+56" + digits;
      return "+" + digits;
    }

    function syncHeaderH(){
      const h = header.offsetHeight || 78;
      document.documentElement.style.setProperty("--headerH", h + "px");
    }

    function isMobile(){
      return window.matchMedia("(max-width: 760px)").matches;
    }

    function setCarouselHints(){
      const show = isMobile();
      document.getElementById("hintFluvial").style.display = show ? "inline" : "none";
      document.getElementById("hintTerr").style.display = show ? "inline" : "none";
    }

    /***** Cards *****/
    function cardHTML(t, label){
      const meta = [];
      if (t.duracion_horas) meta.push(`‚è±Ô∏è ${t.duracion_horas} h`);
      if (t.origen) meta.push(`üìç ${t.origen}`);
      if (t.destino) meta.push(`üß≠ ${t.destino}`);
      if (t.tipo) meta.push(`üß© ${t.tipo}`);
      if (t.nivel) meta.push(`üß≠ ${t.nivel}`);

      const price = [];
      if (t.precio_adulto) price.push(`Adulto: ${fmtCLP(t.precio_adulto)}`);
      if (t.precio_nino) price.push(`Ni√±o: ${fmtCLP(t.precio_nino)}`);

      const safePayload = JSON.stringify({ tipo: label, nombre: t.nombre, id: t.id }).replace(/'/g, "&apos;");

      return `
        <div class="card">
          <div class="tag">${label}</div>
          <h3>${t.nombre}</h3>

          <div class="meta">
            ${meta.map(m => `<span class="mini">${m}</span>`).join("")}
          </div>

          <p class="desc">${t.descripcion || "‚Äî"}</p>

          <div class="price">
            ${price.length ? price.map(p => `<span>${p}</span>`).join("") : `<span style="color:#5a5564;font-weight:500;">Precio a consultar</span>`}
          </div>

          <div class="actions">
            <button class="btn btn-primary" onclick='openReserve(${safePayload})'>Reservar</button>
            <button class="btn btn-ghost" onclick='openInfo(${JSON.stringify(t)}, ${JSON.stringify(label)})'>M√°s informaci√≥n</button>
          </div>
        </div>
      `;
    }

    function render(){
      document.getElementById("year").textContent = new Date().getFullYear();

      document.getElementById("grid-fluviales").innerHTML =
        TOURS_FLUVIALES.map(t => cardHTML(t, "Tour fluvial")).join("");

      document.getElementById("grid-terrestres").innerHTML =
        TOURS_TERRESTRES.map(t => cardHTML(t, "Tour terrestre")).join("");
    }

    /***** Modals state helper (avoid step-scroll blocking inside modal) *****/
    function setModalOpen(open){
      document.documentElement.classList.toggle("modal-open", open);
    }
    function anyModalOpen(){
      const r = document.getElementById("reserveBackdrop").style.display === "flex";
      const i = document.getElementById("infoBackdrop").style.display === "flex";
      const m = document.getElementById("meetBackdrop").style.display === "flex";
      return r || i || m;
    }

    /***** Reserva modal *****/
    let selected = null;

    function openReserve(payload){
      selected = payload;

      document.getElementById("reserveTitle").textContent = (payload?.tipo || "Solicitud") + " ‚Äî " + (payload?.nombre || "");
      document.getElementById("reserveMeta").innerHTML = `
        <span class="chip">üìå ${payload.tipo || "Solicitud"}</span>
        <span class="chip">üó∫Ô∏è ${payload.nombre || "‚Äî"}</span>
      `;

      document.getElementById("r_nombre").value = "";
      document.getElementById("r_tel").value = "";
      document.getElementById("r_personas").value = "";
      document.getElementById("r_fecha").value = "";
      document.getElementById("r_msg").value = "";

      document.getElementById("reserveNote").textContent = WEBHOOK_URL
        ? "‚úÖ Se enviar√° tu solicitud al sistema. Luego te contactamos por WhatsApp."
        : "‚ö†Ô∏è Falta configurar WEBHOOK_URL en el c√≥digo.";

      const b = document.getElementById("reserveBackdrop");
      b.style.display = "flex";
      b.setAttribute("aria-hidden","false");
      setModalOpen(true);
      setTimeout(() => document.getElementById("r_nombre").focus(), 80);
    }

    function closeReserve(){
      const b = document.getElementById("reserveBackdrop");
      b.style.display = "none";
      b.setAttribute("aria-hidden","true");
      selected = null;
      setModalOpen(false);
    }

    async function submitReserve(){
      const nombre = (document.getElementById("r_nombre").value || "").trim();
      const telRaw = (document.getElementById("r_tel").value || "").trim();
      const telefono = normalizePhone(telRaw);
      const personas = (document.getElementById("r_personas").value || "").trim();
      const fecha = (document.getElementById("r_fecha").value || "").trim();
      const mensaje = (document.getElementById("r_msg").value || "").trim();

      if(!nombre || !telefono){ showToast("Falta nombre o tel√©fono."); return; }
      if(!WEBHOOK_URL){ showToast("Falta configurar WEBHOOK_URL."); return; }

      const payload = {
        event: "request",
        source: "vacacionesenelsur_web",
        created_at: new Date().toISOString(),
        tipo: selected?.tipo || "Solicitud",
        item: selected?.nombre || "Consulta",
        item_id: selected?.id || null,
        nombre,
        telefono,
        personas: personas || null,
        fecha: fecha || null,
        mensaje: mensaje || null
      };

      try{
        await fetch(WEBHOOK_URL, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });
        closeReserve();
        showToast("Listo ‚úÖ Te escribiremos por WhatsApp para coordinar horarios y pagos.");
      }catch(e){
        console.warn(e);
        showToast("No se pudo enviar. Intenta otra vez.");
      }
    }

    /***** Info modal *****/
    let infoSelected = null;

    function openInfo(t, label){
      infoSelected = { ...t, label };

      document.getElementById("infoTitle").textContent = t.nombre;
      document.getElementById("infoSubtitle").textContent = label;

      const meta = [];
      if (t.duracion_horas) meta.push(`‚è±Ô∏è ${t.duracion_horas} h`);
      if (t.origen) meta.push(`üìç ${t.origen}`);
      if (t.destino) meta.push(`üß≠ ${t.destino}`);
      if (t.tipo) meta.push(`üß© ${t.tipo}`);
      if (t.nivel) meta.push(`üß≠ ${t.nivel}`);
      if (t.precio_adulto) meta.push(`Adulto: ${fmtCLP(t.precio_adulto)}`);
      if (t.precio_nino) meta.push(`Ni√±o: ${fmtCLP(t.precio_nino)}`);

      document.getElementById("infoMeta").innerHTML = meta.map(x => `<span class="chip">${x}</span>`).join("");
      document.getElementById("infoBody").textContent = t.detallado || "Sin detalle a√∫n.";

      const b = document.getElementById("infoBackdrop");
      b.style.display = "flex";
      b.setAttribute("aria-hidden","false");
      setModalOpen(true);
    }

    function closeInfo(){
      const b = document.getElementById("infoBackdrop");
      b.style.display = "none";
      b.setAttribute("aria-hidden","true");
      infoSelected = null;
      setModalOpen(false);
    }

    function infoReserve(){
      if(!infoSelected) return;
      closeInfo();
      openReserve({ tipo: infoSelected.label, nombre: infoSelected.nombre, id: infoSelected.id });
    }

    /***** Meeting modal *****/
    function openMeeting(){
      document.getElementById("m_nombre").value = "";
      document.getElementById("m_tel").value = "";
      document.getElementById("m_dia").value = "";
      document.getElementById("m_hora").value = "";
      document.getElementById("m_tema").value = "";
      document.getElementById("meetNote").textContent = WEBHOOK_URL
        ? "‚úÖ Se enviar√° tu agenda al sistema. Te confirmamos por WhatsApp."
        : "‚ö†Ô∏è Falta configurar WEBHOOK_URL en el c√≥digo.";

      const b = document.getElementById("meetBackdrop");
      b.style.display = "flex";
      b.setAttribute("aria-hidden","false");
      setModalOpen(true);
      setTimeout(() => document.getElementById("m_nombre").focus(), 80);
    }

    function closeMeeting(){
      const b = document.getElementById("meetBackdrop");
      b.style.display = "none";
      b.setAttribute("aria-hidden","true");
      setModalOpen(false);
    }

    async function submitMeeting(){
      const nombre = (document.getElementById("m_nombre").value || "").trim();
      const telRaw = (document.getElementById("m_tel").value || "").trim();
      const telefono = normalizePhone(telRaw);
      const dia = (document.getElementById("m_dia").value || "").trim();
      const hora = (document.getElementById("m_hora").value || "").trim();
      const tema = (document.getElementById("m_tema").value || "").trim();

      if(!nombre || !telefono || !dia || !hora){ showToast("Falta nombre, tel√©fono, d√≠a u hora."); return; }
      if(!WEBHOOK_URL){ showToast("Falta configurar WEBHOOK_URL."); return; }

      const payload = {
        event: "meeting_request",
        source: "vacacionesenelsur_web",
        created_at: new Date().toISOString(),
        nombre,
        telefono,
        dia,
        hora,
        timezone: "America/Santiago",
        tema: tema || null
      };

      try{
        await fetch(WEBHOOK_URL, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });
        closeMeeting();
        showToast("Reuni√≥n solicitada ‚úÖ Te confirmamos por WhatsApp.");
      }catch(e){
        console.warn(e);
        showToast("No se pudo enviar. Intenta otra vez.");
      }
    }

    /***** ‚úÖ STEP MODE (point by point) *****/
    const modeBtn = document.getElementById("modeBtn");
    const modeText = document.getElementById("modeText");
    const steps = Array.from(document.querySelectorAll("[data-step]"));
    const dots = document.getElementById("dots");

    let stepMode = true;               // default ON
    let stepIndex = 0;
    let lock = false;
    let touchStartY = null;

    function buildDots(){
      dots.innerHTML = "";
      steps.forEach((s, idx) => {
        const b = document.createElement("button");
        b.type = "button";
        b.title = s.id || ("Secci√≥n " + (idx+1));
        b.addEventListener("click", () => goToStep(idx));
        dots.appendChild(b);
      });
      updateDots();
    }

    function updateDots(){
      const arr = Array.from(dots.querySelectorAll("button"));
      arr.forEach((b, i) => b.classList.toggle("active", i === stepIndex));
    }

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function nearestStepIndex(){
      const y = scroller.scrollTop;
      let best = 0;
      let bestDist = Infinity;
      steps.forEach((s, i) => {
        const d = Math.abs(s.offsetTop - y);
        if(d < bestDist){ bestDist = d; best = i; }
      });
      return best;
    }

    function goToStep(i){
      stepIndex = clamp(i, 0, steps.length - 1);
      scroller.scrollTo({ top: steps[stepIndex].offsetTop, behavior:"smooth" });
      updateDots();
    }

    function navTo(id){
      const idx = steps.findIndex(s => s.id === id);
      if(idx >= 0 && stepMode){
        goToStep(idx);
      }else{
        const el = document.getElementById(id);
        if(!el) return;
        scroller.scrollTo({ top: el.offsetTop, behavior:"smooth" });
      }
    }

    function setStepMode(on){
      stepMode = !!on;
      document.documentElement.classList.toggle("step-mode", stepMode);

      modeBtn.dataset.on = stepMode ? "true" : "false";
      modeText.textContent = stepMode ? "Paso a paso: ON" : "Paso a paso: OFF";

      if(stepMode){
        stepIndex = nearestStepIndex();
        updateDots();
      }
    }

    function tryLock(){
      if(lock) return false;
      lock = true;
      setTimeout(()=> lock=false, 650);
      return true;
    }

    function onWheel(e){
      if(!stepMode) return;
      if(anyModalOpen()) return;              // let modal scroll
      e.preventDefault();
      if(!tryLock()) return;

      const dy = e.deltaY || 0;
      if(dy > 8) goToStep(stepIndex + 1);
      else if(dy < -8) goToStep(stepIndex - 1);
    }

    function onTouchStart(e){
      if(!stepMode) return;
      if(anyModalOpen()) return;
      if(e.touches && e.touches.length) touchStartY = e.touches[0].clientY;
    }

    function onTouchMove(e){
      if(!stepMode) return;
      if(anyModalOpen()) return;
      // block native vertical scroll so you can't "flick to the end"
      e.preventDefault();
    }

    function onTouchEnd(e){
      if(!stepMode) return;
      if(anyModalOpen()) return;
      if(touchStartY === null) return;

      const endY = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0].clientY : null;
      if(endY === null) { touchStartY = null; return; }

      const diff = touchStartY - endY;
      touchStartY = null;

      if(Math.abs(diff) < 55) return;
      if(!tryLock()) return;

      if(diff > 0) goToStep(stepIndex + 1);
      else goToStep(stepIndex - 1);
    }

    function onKey(e){
      if(!stepMode) return;
      if(anyModalOpen()) return;
      if(["ArrowDown","PageDown"," "].includes(e.key)){
        e.preventDefault();
        if(!tryLock()) return;
        goToStep(stepIndex + 1);
      }
      if(["ArrowUp","PageUp"].includes(e.key)){
        e.preventDefault();
        if(!tryLock()) return;
        goToStep(stepIndex - 1);
      }
    }

    function onScroll(){
      // keep dots synced even if user toggles OFF then scrolls normally
      const idx = nearestStepIndex();
      if(idx !== stepIndex){
        stepIndex = idx;
        updateDots();
      }
    }

    modeBtn.addEventListener("click", () => setStepMode(!stepMode));

    // Close on click outside + ESC
    document.addEventListener("click", (e) => {
      const r = document.getElementById("reserveBackdrop");
      const i = document.getElementById("infoBackdrop");
      const m = document.getElementById("meetBackdrop");
      if (r.style.display==="flex" && e.target===r) closeReserve();
      if (i.style.display==="flex" && e.target===i) closeInfo();
      if (m.style.display==="flex" && e.target===m) closeMeeting();
    });
    document.addEventListener("keydown", (e) => {
      if(e.key==="Escape"){ closeReserve(); closeInfo(); closeMeeting(); }
      onKey(e);
    });

    // Important: non-passive to prevent scroll
    scroller.addEventListener("wheel", onWheel, { passive:false });
    scroller.addEventListener("touchstart", onTouchStart, { passive:true });
    scroller.addEventListener("touchmove", onTouchMove, { passive:false });
    scroller.addEventListener("touchend", onTouchEnd, { passive:true });
    scroller.addEventListener("scroll", onScroll, { passive:true });

    // Init
    syncHeaderH();
    setCarouselHints();
    render();
    buildDots();
    setStepMode(true);

    window.addEventListener("resize", () => {
      syncHeaderH();
      setCarouselHints();
      if(stepMode){
        // keep in current step after resize
        scroller.scrollTo({ top: steps[stepIndex].offsetTop, behavior:"instant" });
      }
    });
  </script>
</body>
</html>

